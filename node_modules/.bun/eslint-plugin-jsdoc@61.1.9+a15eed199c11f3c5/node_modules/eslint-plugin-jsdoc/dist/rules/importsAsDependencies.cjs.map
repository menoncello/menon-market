{"version":3,"file":"importsAsDependencies.cjs","names":["_iterateJsdoc","_interopRequireDefault","require","_jsdoccomment","resolve","_interopRequireWildcard","_nodeFs","_nodeModule","_nodePath","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","deps","setDeps","pkg","JSON","parse","readFileSync","join","process","cwd","Set","dependencies","keys","devDependencies","error","console","log","moduleCheck","Map","_default","exports","iterateJsdoc","jsdoc","settings","utils","undefined","mode","tag","tags","typeAst","tryParse","type","traverse","nde","mod","element","value","replace","test","isBuiltinModule","types","typings","conditions","reportJSDoc","iterateAllJsdocs","meta","docs","description","url","module"],"sources":["../../src/rules/importsAsDependencies.js"],"sourcesContent":["import iterateJsdoc from '../iterateJsdoc.js';\nimport {\n  parse,\n  traverse,\n  tryParse,\n} from '@es-joy/jsdoccomment';\nimport * as resolve from '@es-joy/resolve.exports';\nimport {\n  readFileSync,\n} from 'node:fs';\nimport {\n  isBuiltin as isBuiltinModule,\n} from 'node:module';\nimport {\n  join,\n} from 'node:path';\n\n/**\n * @type {Set<string>|null}\n */\nlet deps;\n\nconst setDeps = function () {\n  try {\n    const pkg = JSON.parse(\n      readFileSync(join(process.cwd(), './package.json'), 'utf8'),\n    );\n    deps = new Set([\n      ...(pkg.dependencies ?\n        /* c8 ignore next 2 */\n        Object.keys(pkg.dependencies) :\n        []),\n      ...(pkg.devDependencies ?\n        /* c8 ignore next 2 */\n        Object.keys(pkg.devDependencies) :\n        []),\n    ]);\n  /* c8 ignore next -- our package.json exists */\n  } catch (error) {\n    /* c8 ignore next -- our package.json exists */\n    deps = null;\n    /* c8 ignore next 4 -- our package.json exists */\n    /* eslint-disable no-console -- Inform user */\n    console.log(error);\n    /* eslint-enable no-console -- Inform user */\n  }\n};\n\nconst moduleCheck = new Map();\n\nexport default iterateJsdoc(({\n  jsdoc,\n  settings,\n  utils,\n}) => {\n  if (deps === undefined) {\n    setDeps();\n  }\n\n  /* c8 ignore next 3 -- our package.json exists */\n  if (deps === null) {\n    return;\n  }\n\n  const {\n    mode,\n  } = settings;\n\n  for (const tag of jsdoc.tags) {\n    let typeAst;\n    try {\n      typeAst = mode === 'permissive' ? tryParse(tag.type) : parse(tag.type, mode);\n    } catch {\n      continue;\n    }\n\n    // eslint-disable-next-line no-loop-func -- Safe\n    traverse(typeAst, (nde) => {\n      /* c8 ignore next 3 -- TS guard */\n      if (deps === null) {\n        return;\n      }\n\n      if (nde.type === 'JsdocTypeImport') {\n        let mod = nde.element.value.replace(\n          /^(@[^\\/]+\\/[^\\/]+|[^\\/]+).*$/v, '$1',\n        );\n\n        if ((/^[.\\/]/v).test(mod)) {\n          return;\n        }\n\n        if (isBuiltinModule(mod)) {\n          // mod = '@types/node';\n          // moduleCheck.set(mod, !deps.has(mod));\n          return;\n        } else if (!moduleCheck.has(mod)) {\n          let pkg;\n          try {\n            pkg = JSON.parse(\n              readFileSync(join(process.cwd(), 'node_modules', mod, './package.json'), 'utf8'),\n            );\n          } catch {\n            // Ignore\n          }\n\n          try {\n            if (!pkg || (!pkg.types && !pkg.typings && !resolve.exports(pkg, '.', {\n              conditions: [\n                '!default', '!import', '!node', 'types',\n              ],\n            }))) {\n              mod = `@types/${mod}`;\n            }\n          } catch {\n            mod = `@types/${mod}`;\n          }\n\n          moduleCheck.set(mod, !deps.has(mod));\n        }\n\n        if (moduleCheck.get(mod)) {\n          utils.reportJSDoc(\n            'import points to package which is not found in dependencies',\n            tag,\n          );\n        }\n      }\n    });\n  }\n}, {\n  iterateAllJsdocs: true,\n  meta: {\n    docs: {\n      description: 'Reports if JSDoc `import()` statements point to a package which is not listed in `dependencies` or `devDependencies`',\n      url: 'https://github.com/gajus/eslint-plugin-jsdoc/blob/main/docs/rules/imports-as-dependencies.md#repos-sticky-header',\n    },\n    type: 'suggestion',\n  },\n});\n"],"mappings":"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","ignoreList":[]}