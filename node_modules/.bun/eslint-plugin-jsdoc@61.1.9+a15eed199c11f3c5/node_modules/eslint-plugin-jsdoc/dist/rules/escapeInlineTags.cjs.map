{"version":3,"file":"escapeInlineTags.cjs","names":["_iterateJsdoc","_interopRequireDefault","require","e","__esModule","default","_default","exports","iterateJsdoc","context","jsdoc","settings","utils","mode","allowedInlineTags","enableFixer","fixType","options","description","getDescription","tagNames","indexes","unescapedInlineTagRegex","idx","descLine","startsWith","slice","split","entries","replaceAll","_","tagName","includes","push","reportJSDoc","line","setBlockDescription","info","seedTokens","descLines","map","desc","newDesc","RegExp","number","source","tokens","postDelimiter","trim","escapeInlineTags","regex","tag","tags","getTagDescription","some","exec","setTagDescription","iterateAllJsdocs","meta","docs","url","fixable","schema","additionalProperties","properties","items","type","enum","module"],"sources":["../../src/rules/escapeInlineTags.js"],"sourcesContent":["import iterateJsdoc from '../iterateJsdoc.js';\n\nexport default iterateJsdoc(({\n  context,\n  jsdoc,\n  settings,\n  utils,\n}) => {\n  const {\n    mode,\n  } = settings;\n\n  if (mode !== 'typescript') {\n    return;\n  }\n\n  const {\n    allowedInlineTags = [],\n    enableFixer = false,\n    fixType = 'backslash',\n  } = context.options[0] || {};\n\n  const {\n    description,\n  } = utils.getDescription();\n\n  /** @type {string[]} */\n  const tagNames = [];\n\n  /** @type {number[]} */\n  const indexes = [];\n\n  const unescapedInlineTagRegex = /(?:^|\\s)@(\\w+)/gv;\n  for (const [\n    idx,\n    descLine,\n  ] of (\n      description.startsWith('\\n') ? description.slice(1) : description\n    ).split('\\n').entries()\n  ) {\n    descLine.replaceAll(unescapedInlineTagRegex, (_, tagName) => {\n      if (allowedInlineTags.includes(tagName)) {\n        return _;\n      }\n\n      tagNames.push(tagName);\n      indexes.push(idx);\n\n      return _;\n    });\n  }\n\n  for (const [\n    idx,\n    tagName,\n  ] of tagNames.entries()) {\n    utils.reportJSDoc(\n      `Unexpected inline JSDoc tag. Did you mean to use {@${tagName}}, \\\\@${tagName}, or \\`@${tagName}\\`?`,\n      {\n        line: indexes[idx] + 1,\n      },\n      enableFixer ?\n        () => {\n          utils.setBlockDescription((info, seedTokens, descLines) => {\n            return descLines.map((desc) => {\n              const newDesc = desc.replaceAll(\n                new RegExp(`(^|\\\\s)@${\n                  // No need to escape, as contains only safe characters\n                  tagName\n                }`, 'gv'),\n                fixType === 'backticks' ? '$1`@' + tagName + '`' : '$1\\\\@' + tagName,\n              );\n\n              return {\n                number: 0,\n                source: '',\n                tokens: seedTokens({\n                  ...info,\n                  description: newDesc,\n                  postDelimiter: newDesc.trim() ? ' ' : '',\n                }),\n              };\n            });\n          });\n        } :\n        null,\n    );\n  }\n\n  /**\n   * @param {string} tagName\n   * @returns {[\n   *   RegExp,\n   *   (description: string) => string\n   * ]}\n   */\n  const escapeInlineTags = (tagName) => {\n    const regex = new RegExp(`(^|\\\\s)@${\n      // No need to escape, as contains only safe characters\n      tagName\n    }`, 'gv');\n\n    return [\n      regex,\n      /**\n       * @param {string} desc\n       */\n      (desc) => {\n        return desc.replaceAll(\n          regex,\n          fixType === 'backticks' ? '$1`@' + tagName + '`' : '$1\\\\@' + tagName,\n        );\n      },\n    ];\n  };\n\n  for (const tag of jsdoc.tags) {\n    if (tag.tag === 'example') {\n      continue;\n    }\n\n    /** @type {string} */\n    let tagName = '';\n    while (/** @type {string[]} */ (\n      utils.getTagDescription(tag, true)\n    // eslint-disable-next-line no-loop-func -- Safe\n    ).some((desc) => {\n      tagName = unescapedInlineTagRegex.exec(desc)?.[1] ?? '';\n      if (allowedInlineTags.includes(tagName)) {\n        return false;\n      }\n\n      return tagName;\n    })) {\n      const line = utils.setTagDescription(tag, ...escapeInlineTags(tagName)) +\n          tag.source[0].number;\n      utils.reportJSDoc(\n        `Unexpected inline JSDoc tag. Did you mean to use {@${tagName}}, \\\\@${tagName}, or \\`@${tagName}\\`?`,\n        {\n          line,\n        },\n        enableFixer ? () => {} : null,\n        true,\n      );\n    }\n  }\n}, {\n  iterateAllJsdocs: true,\n  meta: {\n    docs: {\n      description: 'Reports use of JSDoc tags in non-tag positions (in the default \"typescript\" mode).',\n      url: 'https://github.com/gajus/eslint-plugin-jsdoc/blob/main/docs/rules/escape-inline-tags.md#repos-sticky-header',\n    },\n    fixable: 'code',\n    schema: [\n      {\n        additionalProperties: false,\n        properties: {\n          allowedInlineTags: {\n            description: 'A listing of tags you wish to allow unescaped. Defaults to an empty array.',\n            items: {\n              type: 'string',\n            },\n            type: 'array',\n          },\n          enableFixer: {\n            description: 'Whether to enable the fixer. Defaults to `false`.',\n            type: 'boolean',\n          },\n          fixType: {\n            description: `How to escape the inline tag.\n\nMay be \"backticks\" to enclose tags in backticks (treating as code segments), or\n\"backslash\" to escape tags with a backslash, i.e., \\`\\\\@\\`\n\nDefaults to \"backslash\".`,\n            enum: [\n              'backticks',\n              'backslash',\n            ],\n            type: 'string',\n          },\n        },\n        type: 'object',\n      },\n    ],\n    type: 'suggestion',\n  },\n});\n"],"mappings":";;;;;;AAAA,IAAAA,aAAA,GAAAC,sBAAA,CAAAC,OAAA;AAA8C,SAAAD,uBAAAE,CAAA,WAAAA,CAAA,IAAAA,CAAA,CAAAC,UAAA,GAAAD,CAAA,KAAAE,OAAA,EAAAF,CAAA;AAAA,IAAAG,QAAA,GAAAC,OAAA,CAAAF,OAAA,GAE/B,IAAAG,qBAAY,EAAC,CAAC;EAC3BC,OAAO;EACPC,KAAK;EACLC,QAAQ;EACRC;AACF,CAAC,KAAK;EACJ,MAAM;IACJC;EACF,CAAC,GAAGF,QAAQ;EAEZ,IAAIE,IAAI,KAAK,YAAY,EAAE;IACzB;EACF;EAEA,MAAM;IACJC,iBAAiB,GAAG,EAAE;IACtBC,WAAW,GAAG,KAAK;IACnBC,OAAO,GAAG;EACZ,CAAC,GAAGP,OAAO,CAACQ,OAAO,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC;EAE5B,MAAM;IACJC;EACF,CAAC,GAAGN,KAAK,CAACO,cAAc,CAAC,CAAC;;EAE1B;EACA,MAAMC,QAAQ,GAAG,EAAE;;EAEnB;EACA,MAAMC,OAAO,GAAG,EAAE;EAElB,MAAMC,uBAAuB,GAAG,kBAAkB;EAClD,KAAK,MAAM,CACTC,GAAG,EACHC,QAAQ,CACT,IAAI,CACDN,WAAW,CAACO,UAAU,CAAC,IAAI,CAAC,GAAGP,WAAW,CAACQ,KAAK,CAAC,CAAC,CAAC,GAAGR,WAAW,EACjES,KAAK,CAAC,IAAI,CAAC,CAACC,OAAO,CAAC,CAAC,EACvB;IACAJ,QAAQ,CAACK,UAAU,CAACP,uBAAuB,EAAE,CAACQ,CAAC,EAAEC,OAAO,KAAK;MAC3D,IAAIjB,iBAAiB,CAACkB,QAAQ,CAACD,OAAO,CAAC,EAAE;QACvC,OAAOD,CAAC;MACV;MAEAV,QAAQ,CAACa,IAAI,CAACF,OAAO,CAAC;MACtBV,OAAO,CAACY,IAAI,CAACV,GAAG,CAAC;MAEjB,OAAOO,CAAC;IACV,CAAC,CAAC;EACJ;EAEA,KAAK,MAAM,CACTP,GAAG,EACHQ,OAAO,CACR,IAAIX,QAAQ,CAACQ,OAAO,CAAC,CAAC,EAAE;IACvBhB,KAAK,CAACsB,WAAW,CACf,sDAAsDH,OAAO,SAASA,OAAO,WAAWA,OAAO,KAAK,EACpG;MACEI,IAAI,EAAEd,OAAO,CAACE,GAAG,CAAC,GAAG;IACvB,CAAC,EACDR,WAAW,GACT,MAAM;MACJH,KAAK,CAACwB,mBAAmB,CAAC,CAACC,IAAI,EAAEC,UAAU,EAAEC,SAAS,KAAK;QACzD,OAAOA,SAAS,CAACC,GAAG,CAAEC,IAAI,IAAK;UAC7B,MAAMC,OAAO,GAAGD,IAAI,CAACZ,UAAU,CAC7B,IAAIc,MAAM,CAAC;UACT;UACAZ,OAAO,EACP,EAAE,IAAI,CAAC,EACTf,OAAO,KAAK,WAAW,GAAG,MAAM,GAAGe,OAAO,GAAG,GAAG,GAAG,OAAO,GAAGA,OAC/D,CAAC;UAED,OAAO;YACLa,MAAM,EAAE,CAAC;YACTC,MAAM,EAAE,EAAE;YACVC,MAAM,EAAER,UAAU,CAAC;cACjB,GAAGD,IAAI;cACPnB,WAAW,EAAEwB,OAAO;cACpBK,aAAa,EAAEL,OAAO,CAACM,IAAI,CAAC,CAAC,GAAG,GAAG,GAAG;YACxC,CAAC;UACH,CAAC;QACH,CAAC,CAAC;MACJ,CAAC,CAAC;IACJ,CAAC,GACD,IACJ,CAAC;EACH;;EAEA;AACF;AACA;AACA;AACA;AACA;AACA;EACE,MAAMC,gBAAgB,GAAIlB,OAAO,IAAK;IACpC,MAAMmB,KAAK,GAAG,IAAIP,MAAM,CAAC;IACvB;IACAZ,OAAO,EACP,EAAE,IAAI,CAAC;IAET,OAAO,CACLmB,KAAK;IACL;AACN;AACA;IACOT,IAAI,IAAK;MACR,OAAOA,IAAI,CAACZ,UAAU,CACpBqB,KAAK,EACLlC,OAAO,KAAK,WAAW,GAAG,MAAM,GAAGe,OAAO,GAAG,GAAG,GAAG,OAAO,GAAGA,OAC/D,CAAC;IACH,CAAC,CACF;EACH,CAAC;EAED,KAAK,MAAMoB,GAAG,IAAIzC,KAAK,CAAC0C,IAAI,EAAE;IAC5B,IAAID,GAAG,CAACA,GAAG,KAAK,SAAS,EAAE;MACzB;IACF;;IAEA;IACA,IAAIpB,OAAO,GAAG,EAAE;IAChB,OAAO,uBACLnB,KAAK,CAACyC,iBAAiB,CAACF,GAAG,EAAE,IAAI;IACnC;IAAA,CACEG,IAAI,CAAEb,IAAI,IAAK;MACfV,OAAO,GAAGT,uBAAuB,CAACiC,IAAI,CAACd,IAAI,CAAC,GAAG,CAAC,CAAC,IAAI,EAAE;MACvD,IAAI3B,iBAAiB,CAACkB,QAAQ,CAACD,OAAO,CAAC,EAAE;QACvC,OAAO,KAAK;MACd;MAEA,OAAOA,OAAO;IAChB,CAAC,CAAC,EAAE;MACF,MAAMI,IAAI,GAAGvB,KAAK,CAAC4C,iBAAiB,CAACL,GAAG,EAAE,GAAGF,gBAAgB,CAAClB,OAAO,CAAC,CAAC,GACnEoB,GAAG,CAACN,MAAM,CAAC,CAAC,CAAC,CAACD,MAAM;MACxBhC,KAAK,CAACsB,WAAW,CACf,sDAAsDH,OAAO,SAASA,OAAO,WAAWA,OAAO,KAAK,EACpG;QACEI;MACF,CAAC,EACDpB,WAAW,GAAG,MAAM,CAAC,CAAC,GAAG,IAAI,EAC7B,IACF,CAAC;IACH;EACF;AACF,CAAC,EAAE;EACD0C,gBAAgB,EAAE,IAAI;EACtBC,IAAI,EAAE;IACJC,IAAI,EAAE;MACJzC,WAAW,EAAE,oFAAoF;MACjG0C,GAAG,EAAE;IACP,CAAC;IACDC,OAAO,EAAE,MAAM;IACfC,MAAM,EAAE,CACN;MACEC,oBAAoB,EAAE,KAAK;MAC3BC,UAAU,EAAE;QACVlD,iBAAiB,EAAE;UACjBI,WAAW,EAAE,4EAA4E;UACzF+C,KAAK,EAAE;YACLC,IAAI,EAAE;UACR,CAAC;UACDA,IAAI,EAAE;QACR,CAAC;QACDnD,WAAW,EAAE;UACXG,WAAW,EAAE,mDAAmD;UAChEgD,IAAI,EAAE;QACR,CAAC;QACDlD,OAAO,EAAE;UACPE,WAAW,EAAE;AACzB;AACA;AACA;AACA;AACA,yBAAyB;UACbiD,IAAI,EAAE,CACJ,WAAW,EACX,WAAW,CACZ;UACDD,IAAI,EAAE;QACR;MACF,CAAC;MACDA,IAAI,EAAE;IACR,CAAC,CACF;IACDA,IAAI,EAAE;EACR;AACF,CAAC,CAAC;AAAAE,MAAA,CAAA7D,OAAA,GAAAA,OAAA,CAAAF,OAAA","ignoreList":[]}